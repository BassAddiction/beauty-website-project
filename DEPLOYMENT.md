# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Speed VPN –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç Speed VPN –Ω–∞ –≤–∞—à–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã.

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
6. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Frontend](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-frontend)
7. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Backend —Ñ—É–Ω–∫—Ü–∏–π](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-backend-—Ñ—É–Ω–∫—Ü–∏–π)
8. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–≤–µ–±—Ö—É–∫–æ–≤)
9. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
10. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
11. [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
12. [Troubleshooting](#troubleshooting)

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É:
- **OS:** Ubuntu 20.04 LTS –∏–ª–∏ –≤—ã—à–µ / Debian 11+
- **CPU:** 2 cores
- **RAM:** 4 GB
- **Disk:** 20 GB SSD
- **Network:** 100 Mbps

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **OS:** Ubuntu 22.04 LTS
- **CPU:** 4 cores
- **RAM:** 8 GB
- **Disk:** 50 GB SSD
- **Network:** 1 Gbps

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- PostgreSQL 14+
- Node.js 18+ / Bun 1.0+
- Python 3.11+
- Nginx
- Certbot (–¥–ª—è SSL)
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
sudo apt update && sudo apt upgrade -y
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

```bash
sudo apt install -y curl wget git build-essential nginx certbot python3-certbot-nginx
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall

```bash
sudo ufw allow 22/tcp      # SSH
sudo ufw allow 80/tcp      # HTTP
sudo ufw allow 443/tcp     # HTTPS
sudo ufw allow 5432/tcp    # PostgreSQL (–µ—Å–ª–∏ –ë–î –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ)
sudo ufw enable
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### Node.js (—á–µ—Ä–µ–∑ nvm)

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
```

### Bun (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ npm, –±—ã—Å—Ç—Ä–µ–µ)

```bash
curl -fsSL https://bun.sh/install | bash
source ~/.bashrc
```

### Python 3.11

```bash
sudo apt install -y python3.11 python3.11-venv python3.11-dev
```

### PostgreSQL 14

```bash
sudo apt install -y postgresql-14 postgresql-contrib-14
sudo systemctl enable postgresql
sudo systemctl start postgresql
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
sudo -u postgres psql
```

–í PostgreSQL –∫–æ–Ω—Å–æ–ª–∏:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER speedvpn_user WITH PASSWORD 'your_secure_password_here';

-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
CREATE DATABASE speedvpn_db OWNER speedvpn_user;

-- –í—ã–¥–∞—á–∞ –ø—Ä–∞–≤
GRANT ALL PRIVILEGES ON DATABASE speedvpn_db TO speedvpn_user;

-- –í—ã—Ö–æ–¥
\q
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–µ—Å–ª–∏ –ë–î –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)

–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `postgresql.conf`:

```bash
sudo nano /etc/postgresql/14/main/postgresql.conf
```

–ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É `listen_addresses` –∏ –º–µ–Ω—è–µ–º –Ω–∞:

```
listen_addresses = '*'
```

–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º `pg_hba.conf`:

```bash
sudo nano /etc/postgresql/14/main/pg_hba.conf
```

–î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü:

```
# –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ IP
host    speedvpn_db     speedvpn_user   YOUR_SERVER_IP/32    md5

# –ò–ª–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å –ª—é–±–æ–≥–æ IP (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
host    all             all             0.0.0.0/0            md5
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º PostgreSQL:

```bash
sudo systemctl restart postgresql
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è DATABASE_URL

```
postgresql://speedvpn_user:your_secure_password_here@localhost:5432/speedvpn_db

# –ò–ª–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î:
postgresql://speedvpn_user:your_secure_password_here@db_server_ip:5432/speedvpn_db
```

### 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:

```bash
cd /var/www
git clone https://github.com/your-username/speedvpn.git
cd speedvpn
```

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
nano .env
```

–î–æ–±–∞–≤—å—Ç–µ:

```env
DATABASE_URL=postgresql://speedvpn_user:your_secure_password_here@localhost:5432/speedvpn_db
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î
psql postgresql://speedvpn_user:your_secure_password_here@localhost:5432/speedvpn_db

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ db_migrations/ –ø–æ –ø–æ—Ä—è–¥–∫—É
\i db_migrations/V0001__initial_schema.sql
\i db_migrations/V0002__add_users_table.sql
# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
for file in db_migrations/*.sql; do
  echo "Applying migration: $file"
  psql postgresql://speedvpn_user:your_secure_password_here@localhost:5432/speedvpn_db -f "$file"
done
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `.env`

```bash
cd /var/www/speedvpn
nano .env
```

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://speedvpn_user:your_password@localhost:5432/speedvpn_db

# –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
ADMIN_PASSWORD=your_super_secure_admin_password

# –ÆKassa (–ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=live_your_secret_key

# Remnawave (VPN –ø–∞–Ω–µ–ª—å)
REMNAWAVE_API_URL=https://your-vpn-panel.com
REMNAWAVE_API_TOKEN=your_remnawave_api_token
REMNAWAVE_FUNCTION_URL=https://your-domain.com/api/remnawave
USER_SQUAD_UUIDS=uuid1,uuid2,uuid3
USER_TRAFFIC_LIMIT_GB=30
USER_TRAFFIC_STRATEGY=MONTH

# Email —Å–µ—Ä–≤–∏—Å—ã
RESEND_API_KEY=re_your_resend_key
UNISENDER_API_KEY=your_unisender_key

# URLs
FRONTEND_URL=https://speedvpn.io
BACKEND_URL=https://api.speedvpn.io
```

### 3. –ó–∞—â–∏—Ç–∞ —Ñ–∞–π–ª–∞ `.env`

```bash
chmod 600 .env
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Frontend

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /var/www/speedvpn
bun install
# –∏–ª–∏ npm install
```

### 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
bun run build
# –∏–ª–∏ npm run build
```

–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏ –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ `dist/`.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
sudo nano /etc/nginx/sites-available/speedvpn
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```nginx
server {
    listen 80;
    server_name speedvpn.io www.speedvpn.io;

    root /var/www/speedvpn/dist;
    index index.html;

    # Gzip —Å–∂–∞—Ç–∏–µ
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_comp_level 6;

    # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA —Ä–æ—É—Ç–∏–Ω–≥
    location / {
        try_files $uri $uri/ /index.html;
    }

    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
}
```

–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
sudo ln -s /etc/nginx/sites-available/speedvpn /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
sudo certbot --nginx -d speedvpn.io -d www.speedvpn.io
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

```bash
sudo systemctl enable certbot.timer
sudo systemctl start certbot.timer
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Backend —Ñ—É–Ω–∫—Ü–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Serverless –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç serverless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. Backend —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ø–∞–ø–∫–µ `backend/` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞:

- **Yandex Cloud Functions** (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)
- **AWS Lambda**
- **Google Cloud Functions**
- **Azure Functions**
- **Vercel Functions**
- **Netlify Functions**

#### –ü—Ä–∏–º–µ—Ä —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ AWS Lambda:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ credentials
aws configure

# –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ Lambda:
cd backend/payment
zip -r payment.zip .
aws lambda create-function \
  --function-name speedvpn-payment \
  --runtime python3.11 \
  --role arn:aws:iam::YOUR_ACCOUNT:role/lambda-role \
  --handler index.handler \
  --zip-file fileb://payment.zip

# –°–æ–∑–¥–∞–π—Ç–µ API Gateway –¥–ª—è HTTP –¥–æ—Å—Ç—É–ø–∞
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ –Ω–∞ —Å–≤–æ–µ–º —Å–µ—Ä–≤–µ—Ä–µ (Express.js wrapper)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/server.js`:

```javascript
const express = require('express');
const app = express();
const cors = require('cors');

app.use(cors());
app.use(express.json());

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
const payment = require('./payment/index.py');
const plans = require('./plans/index.ts');
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

// –†–æ—É—Ç–∏–Ω–≥
app.post('/api/payment', async (req, res) => {
  const event = {
    httpMethod: 'POST',
    headers: req.headers,
    body: JSON.stringify(req.body),
  };
  const result = await payment.handler(event, {});
  res.status(result.statusCode).send(result.body);
});

// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Backend running on port ${PORT}`);
});
```

–°–æ–∑–¥–∞–π—Ç–µ systemd service:

```bash
sudo nano /etc/systemd/system/speedvpn-backend.service
```

```ini
[Unit]
Description=Speed VPN Backend
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/speedvpn/backend
ExecStart=/usr/bin/node server.js
Restart=on-failure
Environment="NODE_ENV=production"
EnvironmentFile=/var/www/speedvpn/.env

[Install]
WantedBy=multi-user.target
```

–ó–∞–ø—É—Å–∫:

```bash
sudo systemctl enable speedvpn-backend
sudo systemctl start speedvpn-backend
sudo systemctl status speedvpn-backend
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –¥–ª—è Backend API

```bash
sudo nano /etc/nginx/sites-available/speedvpn
```

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```nginx
# Backend API
location /api/ {
    proxy_pass http://localhost:3000/api/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_cache_bypass $http_upgrade;
}
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx:

```bash
sudo nginx -t
sudo systemctl reload nginx
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

### 1. –ÆKassa (–ø–ª–∞—Ç–µ–∂–∏)

#### –°–æ–∑–¥–∞–Ω–∏–µ webhook endpoint

Backend —Ñ—É–Ω–∫—Ü–∏—è `payment` —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏. URL –¥–ª—è webhook:

```
https://speedvpn.io/api/payment
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ÆKassa:

1. –ó–∞–π–¥–∏—Ç–µ –≤ [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa](https://yookassa.ru/my/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
3. –î–æ–±–∞–≤—å—Ç–µ URL: `https://speedvpn.io/api/payment`
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded` (—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞)
   - ‚úÖ `payment.canceled` (–æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞)
   - ‚úÖ `refund.succeeded` (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤)

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
cd /var/www/speedvpn
nano test-webhook.js
```

```javascript
const express = require('express');
const app = express();
app.use(express.json());

app.post('/api/payment', (req, res) => {
  console.log('Received webhook:', JSON.stringify(req.body, null, 2));
  console.log('Headers:', req.headers);
  res.json({ success: true });
});

app.listen(3000, () => console.log('Webhook test server on port 3000'));
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
node test-webhook.js
```

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –∏–∑ –ÆKassa –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏.

### 2. Remnawave (VPN –ø–∞–Ω–µ–ª—å)

–ï—Å–ª–∏ Remnawave –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏, —Å–æ–∑–¥–∞–π—Ç–µ endpoint:

```
https://speedvpn.io/api/remnawave-webhook
```

–î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ backend:

```python
# backend/remnawave-webhook/index.py
def handler(event, context):
    body = json.loads(event.get('body', '{}'))
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç Remnawave
    event_type = body.get('event')
    
    if event_type == 'user.expired':
        user_id = body.get('user_id')
        # –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –≤ –ë–î
        update_user_subscription(user_id, status='expired')
    
    return {
        'statusCode': 200,
        'body': json.dumps({'status': 'ok'})
    }
```

### 3. Unisender (email)

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ email:

1. –ó–∞–π–¥–∏—Ç–µ –≤ [Unisender –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç](https://cp.unisender.com/)
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–µ–±—Ö—É–∫–∏**
3. –î–æ–±–∞–≤—å—Ç–µ URL: `https://speedvpn.io/api/email-webhook`
4. –°–æ–±—ã—Ç–∏—è:
   - ‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
   - ‚úÖ –û—Ç–∫—Ä—ã—Ç–æ
   - ‚úÖ –ù–∞–∂–∞—Ç–∞ —Å—Å—ã–ª–∫–∞
   - ‚úÖ –û—Ç–ø–∏—Å–∫–∞

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–µ–±—Ö—É–∫–æ–≤

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –ÆKassa:

```python
import hmac
import hashlib

def verify_yookassa_signature(body, signature, secret_key):
    expected = hmac.new(
        secret_key.encode(),
        body.encode(),
        hashlib.sha256
    ).hexdigest()
    return hmac.compare_digest(expected, signature)

# –í handler:
signature = headers.get('x-yookassa-signature')
if not verify_yookassa_signature(body, signature, YOOKASSA_SECRET_KEY):
    return {'statusCode': 401, 'body': 'Invalid signature'}
```

#### IP whitelist

–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±—Ö—É–∫–∞–º —Ç–æ–ª—å–∫–æ —Å IP –ÆKassa:

```nginx
# –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
location /api/payment {
    allow 185.71.76.0/27;
    allow 185.71.77.0/27;
    allow 77.75.153.0/25;
    deny all;
    
    proxy_pass http://localhost:3000/api/payment;
}
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ Certbot

```bash
sudo certbot --nginx -d speedvpn.io -d www.speedvpn.io -d api.speedvpn.io
```

### 2. Wildcard —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤)

```bash
sudo certbot certonly \
  --manual \
  --preferred-challenges=dns \
  -d speedvpn.io \
  -d "*.speedvpn.io"
```

–î–æ–±–∞–≤—å—Ç–µ TXT –∑–∞–ø–∏—Å—å –≤ DNS –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
sudo certbot renew --dry-run
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä–æ–Ω-–∑–∞–¥–∞—á–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
sudo crontab -e
```

–î–æ–±–∞–≤—å—Ç–µ:

```
0 3 * * * certbot renew --quiet --post-hook "systemctl reload nginx"
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### 1. –õ–æ–≥–∏ Nginx

```bash
# –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞
sudo tail -f /var/log/nginx/access.log

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
sudo tail -f /var/log/nginx/error.log
```

### 2. –õ–æ–≥–∏ Backend

```bash
sudo journalctl -u speedvpn-backend -f
```

### 3. –õ–æ–≥–∏ PostgreSQL

```bash
sudo tail -f /var/log/postgresql/postgresql-14-main.log
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ htop:

```bash
sudo apt install htop
htop
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus + Grafana (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus
wget https://github.com/prometheus/prometheus/releases/download/v2.40.0/prometheus-2.40.0.linux-amd64.tar.gz
tar xvfz prometheus-*.tar.gz
cd prometheus-*
./prometheus --config.file=prometheus.yml

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node Exporter
wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz
tar xvfz node_exporter-*.tar.gz
cd node_exporter-*
./node_exporter

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Grafana
sudo apt-get install -y software-properties-common
sudo add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
sudo apt-get update
sudo apt-get install grafana
sudo systemctl start grafana-server
```

Grafana –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `http://your-server:3000` (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: admin)

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π)

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `/root/backup-db.sh`:

```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/backups/speedvpn"
mkdir -p $BACKUP_DIR

# Backup PostgreSQL
pg_dump postgresql://speedvpn_user:password@localhost:5432/speedvpn_db | gzip > "$BACKUP_DIR/speedvpn_db_$DATE.sql.gz"

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö backup (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "speedvpn_db_*.sql.gz" -mtime +7 -delete

echo "Backup completed: speedvpn_db_$DATE.sql.gz"
```

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x /root/backup-db.sh
```

–î–æ–±–∞–≤—å—Ç–µ –≤ cron:

```bash
sudo crontab -e
```

```
0 2 * * * /root/backup-db.sh >> /var/log/speedvpn-backup.log 2>&1
```

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

```bash
gunzip -c /var/backups/speedvpn/speedvpn_db_20231103.sql.gz | psql postgresql://speedvpn_user:password@localhost:5432/speedvpn_db
```

### 3. Backup —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

```bash
tar -czf /var/backups/speedvpn/speedvpn_files_$(date +%Y%m%d).tar.gz \
  /var/www/speedvpn \
  /etc/nginx/sites-available/speedvpn \
  /etc/systemd/system/speedvpn-backend.service
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Frontend

**–û—à–∏–±–∫–∞:** `Cannot GET /`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ dist/
ls -la /var/www/speedvpn/dist

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
cd /var/www/speedvpn
bun run build

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R www-data:www-data /var/www/speedvpn/dist
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500

**–û—à–∏–±–∫–∞:** Internal Server Error

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u speedvpn-backend -n 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
systemctl show speedvpn-backend | grep Environment

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl restart speedvpn-backend
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–ª–∞—Ç–µ–∂–∏

**–û—à–∏–±–∫–∞:** Webhook –Ω–µ –ø–æ–ª—É—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint
curl -X POST https://speedvpn.io/api/payment \
  -H "Content-Type: application/json" \
  -d '{"test": true}'

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ÆKassa –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î

**–û—à–∏–±–∫–∞:** `connection refused` –∏–ª–∏ `authentication failed`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL
sudo systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ pg_hba.conf
sudo nano /etc/postgresql/14/main/pg_hba.conf

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo -u postgres psql
\du

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
psql postgresql://speedvpn_user:password@localhost:5432/speedvpn_db
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–π–º–µ—Ä certbot
sudo systemctl status certbot.timer

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo cat /var/log/letsencrypt/letsencrypt.log
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. CDN (Cloudflare)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Cloudflare](https://www.cloudflare.com/)
2. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω speedvpn.io
3. –°–º–µ–Ω–∏—Ç–µ NS –∑–∞–ø–∏—Å–∏ —É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞
4. –í–∫–ª—é—á–∏—Ç–µ **Proxy** –¥–ª—è –∑–∞–ø–∏—Å–µ–π A/AAAA
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL: **Full (strict)**
6. –í–∫–ª—é—á–∏—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏

### 2. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤)

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –∫–∞–∫ load balancer:

```nginx
upstream backend_servers {
    server 10.0.1.10:3000;
    server 10.0.1.11:3000;
    server 10.0.1.12:3000;
}

server {
    location /api/ {
        proxy_pass http://backend_servers;
    }
}
```

### 3. Rate limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç DDoS)

```nginx
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

location /api/ {
    limit_req zone=api_limit burst=20 nodelay;
    proxy_pass http://localhost:3000;
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ `https://speedvpn.io/admin`
2. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏–∑ `ADMIN_PASSWORD`)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"–ü—Ä–æ–µ–∫—Ç"**
4. –ù–∞–∂–º–∏—Ç–µ **"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"**
5. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (DATABASE_URL, API –∫–ª—é—á–∏ –∏ —Ç.–¥.)
6. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** [https://speedvpn.io/docs](https://speedvpn.io/docs)
- **GitHub Issues:** [https://github.com/your-repo/issues](https://github.com/your-repo/issues)
- **Telegram —Å–æ–æ–±—â–µ—Å—Ç–≤–æ:** [https://t.me/+QgiLIa1gFRY4Y2Iy](https://t.me/+QgiLIa1gFRY4Y2Iy)

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

---

**–£–¥–∞—á–∏ —Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º! üöÄ**
